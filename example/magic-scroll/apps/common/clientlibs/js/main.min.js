!function(t,e){t=t,t.MagicScroll=e()}(this,function(){"use strict";var t=function(t){function e(t,i){if(!(this instanceof e))return new e(t,i);var o={init:!0,obj:t,magicSection:".magic-section",magicArticle:".magic-article",duration:function(){var t=2,e=100*t+"%";return r.isDevice&&(e=r.winSize().h*t+"px"),e}(),triggerHook:0,overlapSpace:!1,initFollowers:!0,pushFollowers:!0,spaceHeight:function(){return 0},animations:[],fixedAutoPlay:!1,customEvent:".Component"+(new Date).getTime()+Math.random(),breakKey:["duration","triggerHook","spaceHeight","overlapSpace","initFollowers","pushFollowers"],breakpoints:{},props:{},stateAttr:{destroy:!1,scroll:null,prevTop:null,resize:null,isOrientationchange:!1},requestAttr:{resize:null},timeAttr:{scrollEnd:null,resizeEnd:null},classAttr:{fixed:"is-fixed"},hasCssSticky:n,on:{"in":null,out:null,hookIn:null,hookOut:null,init:null,allUpdate:null,beforeUpdate:null,afterUpdate:null,update:null}};this.opts=r.def(o,i||{}),(this.obj=s(this.opts.obj)).length&&this.opts.init&&this.init()}var i=window,o=i.document,s=i.jqLite||i.jQuery,n=function(){var t=o.createElement("div");o.body.appendChild(t),t.style.position="sticky";var e=i.getComputedStyle(t,null).getPropertyValue("position");return o.body.removeChild(t),"sticky"==e}(),r={isDevice:function(){var t="ontouchstart"in i||i.DocumentTouch&&o instanceof i.DocumentTouch;return t}(),isOrientationchange:function(){var t="onorientationchange"in i;return t}(),isObject:function(t){return"object"==typeof t&&null!==t&&t.constructor&&t.constructor===Object},def:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];for(var i=Object(t[0]),o=1;o<t.length;o+=1){var s=t[o];if(void 0!==s&&null!==s)for(var n=Object.keys(Object(s)),r=0,a=n.length;a>r;r+=1){var l=n[r],c=Object.getOwnPropertyDescriptor(s,l);void 0!==c&&c.enumerable&&(this.isObject(i[l])&&this.isObject(s[l])?this.def(i[l],s[l]):!this.isObject(i[l])&&this.isObject(s[l])?(i[l]={},this.def(i[l],s[l])):i[l]=s[l])}}return i},winSize:function(){return function(){var t={w:i.innerWidth||o.documentElement.clientWidth||o.body.clientWidth,h:i.innerHeight||o.documentElement.clientHeight||o.body.clientHeight};return t}}(),requestAFrame:function(){return i.requestAnimationFrame||i.webkitRequestAnimationFrame||i.mozRequestAnimationFrame||i.oRequestAnimationFrame||i.msRequestAnimationFrame||function(t){return i.setTimeout(t,1e3/60)}}(),cancelAFrame:function(){return i.cancelAnimationFrame||i.webkitCancelAnimationFrame||i.webkitCancelRequestAnimationFrame||i.mozCancelAnimationFrame||i.oCancelAnimationFrame||i.msCancelAnimationFrame||function(t){i.clearTimeout(t)}}()};return e.prototype={init:function(){this.buildSet(),this.setElements(),this.set.after.build(),this.buildTween(),this.buildMotion(),this.resizeFunc(),this.bindEvents(!0),this.set.load.after()},buildSet:function(){var t=this;r.def(this,{set:{before:{init:function(){var e=t.opts.breakKey,i={};e.forEach(function(e){i[e]=t.opts[e]}),t.bOpts=r.def({},i)},initLayout:function(){var e=t.opts.magicSection.split(".")[1],i=t.opts.magicArticle.split(".")[1],o='<div class="'+e+'"><div class="'+i+'"></div></div>';t.obj.wrap(o)},build:function(){this.init(),this.initLayout()}},after:{initLayout:function(){t.magicSection.css("position","relative"),t.magicArticle.css({position:"sticky",top:0})},buildFixedLayout:function(){var e=t.magicArticle;r.def(t,{fixedlayout:{out_top:function(){e.css({position:"",bottom:""})},out_bot:function(){e.css({position:"fixed",top:t.opts.props.spaceHeight,bottom:""})},out_bot_pushFollowers:function(){e.css({position:"absolute",top:"",bottom:0})},out_not_initFollowers:function(){e.css({position:"",top:t.opts.props.spaceHeight,bottom:""})}}})},build:function(){this.initLayout(),this.buildFixedLayout()}},load:{before:function(){},after:function(){var e=t.opts.props,o=s(i).scrollTop(),n={hookOutB:o>=e.triggerMaxOffset};n.hookOutB&&(t.opts.fixedAutoPlay||t.tween.pause().progress(1)),t.outCallback("init")}},getSize:{winHeight:r.winSize().h,resize:function(){this.winHeight=r.winSize().h}},opts:function(){var e,i=this,o=r.winSize().w,s=r.winSize().h,n=t.opts.breakpoints,a=[];for(var l in n)l>=o?(a.push(l),e=Math.min.apply(null,a)):e=null;var c=r.def({},t.bOpts);null!=e&&(c=r.def(c,n[e])),t.opts.props.spaceHeight=function(){var t=Math.floor(c.spaceHeight(),10);return t}(),t.opts.props.sectionHeight=function(){var e=i.getSize.winHeight/100,o=c.duration,s=parseFloat(o),n=o.indexOf("%")>=0,r=e*s;return n||(r=s),r-t.opts.props.spaceHeight}(),t.opts.props.articleHeight=function(){var e=t.magicArticle.outerHeight(!0);return e}(),function(){var e=t.magicSection.offset(),i=t.magicSection.outerHeight(!0),e=e.top,o=Math.ceil(e-s,10),n=Math.ceil(e+i,10),r=t.opts.props.spaceHeight,a=t.opts.props.articleHeight,l=function(){var t=1-c.triggerHook;t=0>t?0:t>1?1:t;var e=t*s,i=Math.max(s-r,a+r);if(!c.overlapSpace){var o=s-r;e>=o&&(e-=r)}return{min:e,max:i}}();t.opts.props.offset=e,t.opts.props.minOffset=o,t.opts.props.maxOffset=n,t.opts.props.triggerMinOffset=o+l.min,t.opts.props.triggerMaxOffset=n-l.max,t.opts.props.fixedMinOffset=o+s-r,t.opts.props.fixedMaxOffset=n-a-r}(),t.breakOpts=c,t.props=t.opts.props},layout:function(){var e=s(i).scrollTop(),o=r.winSize().h,n=t.opts.props,a=t.breakOpts,l=n.spaceHeight,c=t.opts.props.sectionHeight,u=t.opts.props.articleHeight;t.magicSection.css({height:c}),t.opts.hasCssSticky&&t.magicArticle.css({top:l}),a.initFollowers?t.opts.hasCssSticky||(n.fixedMinOffset>e?t.fixedlayout.out_top():e>=n.fixedMaxOffset&&(a.pushFollowers?t.fixedlayout.out_bot_pushFollowers():t.fixedlayout.out_bot()),a.pushFollowers||(n.minOffset>e?t.fixedlayout.out_top():e>=n.maxOffset&&t.fixedlayout.out_bot_pushFollowers())):(a.pushFollowers&&e>=n.fixedMaxOffset&&t.fixedlayout.out_bot_pushFollowers(),n.minOffset<=e&&e<n.maxOffset||t.fixedlayout.out_not_initFollowers()),t.opts.hasCssSticky&&a.initFollowers||t.magicArticle.css({width:t.magicSection.outerWidth(!0)}),t.magicArticle.css(a.pushFollowers?{"margin-bottom":""}:{"margin-bottom":-1*Math.max(o-l,u+l)})},destroy:function(){t.obj.parent().is(t.opts.magicArticle)&&t.obj.unwrap(),t.obj.parent().is(t.opts.magicSection)&&t.obj.unwrap()}}}),this.set.before.build()},setElements:function(){this.magicArticle=this.obj.parent(this.opts.magicArticle),this.magicSection=this.magicArticle.parent(this.opts.magicSection)},buildTween:function(){var t=this;r.def(this,{tween:{instance:null,destroy:function(){null!=this.instance&&(this.instance.kill(),this.instance=null)},delTweenID:function(t){var e=r.def({},t);return e.hasOwnProperty("_gsTweenID")&&delete e._gsTweenID,e},pause:function(){return null==this.instance?this:(this.instance.pause(),this)},progress:function(t){return null==this.instance?this:(this.instance.progress(t),this)},build:function(){var e=t.opts.animations;if(e.length){var i=this,o=new TimelineMax;o.pause();for(var s=function(t){var s=e[t],n=function(t){var e={};return e.progress="start"==t?0:1,e},a=s.hasOwnProperty("from")?s.from:n("start"),l=s.hasOwnProperty("to")?s.to:n("end"),c=s.hasOwnProperty("duration")?s.duration:0,u=s.hasOwnProperty("onStart"),p=s.hasOwnProperty("onUpdate"),f=s.hasOwnProperty("onComplete"),h=s.hasOwnProperty("onReverseComplete");o.to(a,c,r.def(l,{onUpdate:function(){p&&s.onUpdate(i.delTweenID(a))},onStart:function(){u&&s.onStart(i.delTweenID(a))},onComplete:function(){f&&s.onComplete(i.delTweenID(a))},onReverseComplete:function(){h&&s.onReverseComplete(i.delTweenID(a))}}))},n=0,a=e.length;a>n;n++)s.call(i,n);this.instance=o}}}}),this.tween.build()},buildMotion:function(){var t=this,e=this.opts.props,o=this.opts.classAttr;r.def(this,{motion:{progress:{allUpdate:function(o){var n=s(i).scrollTop();if(o)var r=e.maxOffset-e.minOffset,a=n-e.minOffset,l=a/r;else var l=e.minOffset<=n?1:0;t.opts.props.allProgress=l,t.outCallback("allUpdate")},beforeUpdate:function(o){var n=s(i).scrollTop();if(o)var r=e.triggerMinOffset-e.minOffset,a=n-e.minOffset,l=a/r;else var l=e.minOffset<=n?1:0;t.opts.props.beforeProgress=l,t.outCallback("beforeUpdate")},afterUpdate:function(o){var n=s(i).scrollTop();if(o)var r=e.maxOffset-e.triggerMaxOffset,a=n-e.triggerMaxOffset,l=a/r;else var l=e.triggerMaxOffset<=n?1:0;t.opts.props.afterProgress=l,t.outCallback("afterUpdate")},update:function(o){var n=s(i).scrollTop();if(o)var r=e.triggerMaxOffset-e.triggerMinOffset,a=n-e.triggerMinOffset,l=a/r;else var l=e.triggerMinOffset<=n?1:0;t.opts.props.progress=l,t.tween.progress(l),t.outCallback("update")}},scroll:{stateAttr:{active:null,hookActive:null,fixedActive:null},scope:{out:null,hookOut:null},destroy:function(){},build:function(){var n=s(i).scrollTop(),r=t.breakOpts,a={"in":e.minOffset<=n&&n<e.maxOffset,hookIn:e.triggerMinOffset<=n&&n<e.triggerMaxOffset,fixedIn:e.fixedMinOffset<=n&&n<e.fixedMaxOffset};a["in"]&&"in"!=this.stateAttr.active&&(this.stateAttr.active="in",r.initFollowers?t.opts.hasCssSticky||r.pushFollowers||("FORWARD"==e.direction?t.fixedlayout.out_top():"REVERSE"==e.direction&&t.fixedlayout.out_bot()):"FORWARD"==e.direction?t.fixedlayout.out_bot():"REVERSE"==e.direction&&(r.pushFollowers?t.fixedlayout.out_bot_pushFollowers():t.fixedlayout.out_bot()),t.outCallback("in")),a.hookIn||"out"!=this.stateAttr.hookActive&&(this.stateAttr.hookActive="out",e.triggerMinOffset>n?this.scope.hookOut="TOP":n>=e.triggerMaxOffset&&(this.scope.hookOut="BOTTOM"),t.motion.progress.update(!1),t.outCallback("hookOut")),a["in"]&&(t.motion.progress.allUpdate(!0),e.minOffset<=n&&n<e.triggerMinOffset&&t.motion.progress.beforeUpdate(!0)),a.hookIn&&("in"!=this.stateAttr.hookActive&&(this.stateAttr.hookActive="in","FORWARD"==e.direction?t.motion.progress.beforeUpdate(!1):"REVERSE"==e.direction&&t.motion.progress.afterUpdate(!1),t.outCallback("hookIn")),t.motion.progress.update(!0)),a.fixedIn&&"in"!=this.stateAttr.fixedActive&&(this.stateAttr.fixedActive="in",t.magicArticle.addClass(o.fixed),r.initFollowers?t.opts.hasCssSticky||t.fixedlayout.out_bot():t.fixedlayout.out_bot()),a.fixedIn||"out"!=this.stateAttr.fixedActive&&(this.stateAttr.fixedActive="out",t.magicArticle.removeClass(o.fixed),r.initFollowers?t.opts.hasCssSticky||(e.fixedMinOffset>n?t.fixedlayout.out_top():n>=e.fixedMaxOffset&&(r.pushFollowers?t.fixedlayout.out_bot_pushFollowers():t.fixedlayout.out_bot())):r.pushFollowers&&n>=e.fixedMaxOffset&&t.fixedlayout.out_bot_pushFollowers()),a["in"]&&e.triggerMaxOffset<=n&&n<e.maxOffset&&t.motion.progress.afterUpdate(!0),a["in"]||"out"!=this.stateAttr.active&&(this.stateAttr.active="out",e.minOffset>n?(this.scope.out="TOP",t.motion.progress.beforeUpdate(!1)):n>=e.maxOffset&&(this.scope.out="BOTTOM",t.motion.progress.afterUpdate(!1)),r.initFollowers?t.opts.hasCssSticky||r.pushFollowers||(e.minOffset>n?t.fixedlayout.out_top():n>=e.maxOffset&&t.fixedlayout.out_bot_pushFollowers()):t.fixedlayout.out_not_initFollowers(),t.motion.progress.allUpdate(!1),t.outCallback("out"))}},destroy:function(){this.scroll.destroy()},build:function(){this.scroll.build()}}})},changeEvents:function(t){var e=[],i=t.split(" ");for(var o in i)e.push(i[o]+this.opts.customEvent);return e.join(" ")},bindEvents:function(t){t?(s(i).on(this.changeEvents("scroll"),this.scrollFunc.bind(this)),s(i).on(this.changeEvents("resize orientationchange"),this.resizeFunc.bind(this))):(s(i).off(this.changeEvents("scroll")),s(i).off(this.changeEvents("resize orientationchange")))},scrollFunc:function(){this.winTop=s(i).scrollTop(),this.opts.stateAttr.prevTop>this.winTop?this.opts.props.direction="REVERSE":this.opts.stateAttr.prevTop<this.winTop&&(this.opts.props.direction="FORWARD"),this.opts.stateAttr.prevTop=this.winTop,null==this.opts.stateAttr.scroll&&(this.opts.stateAttr.scroll=this.winTop,this.scrollAnimateFunc()),i.clearTimeout(this.opts.timeAttr.scrollEnd),this.opts.timeAttr.scrollEnd=i.setTimeout(this.scrollEndFunc.bind(this),60)},scrollEndFunc:function(){this.opts.stateAttr.scroll=null,this.opts.stateAttr.destroy||(this.set.opts(),this.motion.build()),r.cancelAFrame.call(i,this.opts.requestAttr.scroll)},scrollAnimateFunc:function(){this.opts.stateAttr.destroy||(this.set.opts(),this.motion.build()),this.opts.requestAttr.scroll=r.requestAFrame.call(i,this.scrollAnimateFunc.bind(this))},resizeFunc:function(e){e!=t&&"orientationchange"==e.type&&(this.opts.stateAttr.isOrientationchange=!0),this.winWidth=r.winSize().w,null==this.opts.stateAttr.resize&&(this.opts.stateAttr.resize=this.winWidth,this.resizeAnimateFunc()),i.clearTimeout(this.opts.timeAttr.resizeEnd),this.opts.timeAttr.resizeEnd=i.setTimeout(this.resizeEndFunc.bind(this),280)},resizeEndFunc:function(){this.opts.stateAttr.resize=null,this.opts.stateAttr.destroy||(r.isOrientationchange?this.opts.stateAttr.isOrientationchange&&this.set.getSize.resize():this.set.getSize.resize(),this.set.opts(),this.set.layout(),this.scrollFunc()),this.opts.stateAttr.isOrientationchange=!1,r.cancelAFrame.call(i,this.opts.requestAttr.resize)},resizeAnimateFunc:function(){this.opts.stateAttr.destroy||(r.isOrientationchange?this.opts.stateAttr.isOrientationchange&&this.set.getSize.resize():this.set.getSize.resize(),this.set.opts(),this.set.layout(),this.scrollFunc()),this.opts.requestAttr.resize=r.requestAFrame.call(i,this.resizeAnimateFunc.bind(this))},destroy:function(){this.opts.stateAttr.destroy=!0,this.bindEvents(!1),this.set.destroy(),this.tween.destroy(),this.motion.destroy()},outCallback:function(t){var e=this.opts.on[t];null!=e&&e()}},e}();return t});