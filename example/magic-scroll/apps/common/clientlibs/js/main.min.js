!function(t,e){t=t,t.MagicScroll=e()}(this,function(){"use strict";var t=function(t){function e(t,i){if(!(this instanceof e))return new e(t,i);var s={init:!0,obj:t,magicSection:".magic-section",magicArticle:".magic-article",duration:null,triggerHook:0,overlapSpace:!1,initFollowers:!0,pushFollowers:!0,spaceHeight:function(){return 0},animations:[],fixedAutoPlay:!1,customEvent:".Component"+(new Date).getTime()+Math.random(),breakKey:["duration","triggerHook","spaceHeight","overlapSpace","initFollowers","pushFollowers"],breakpoints:{},props:{},stateAttr:{destroy:!1,scroll:null,prevTop:null,resize:null,isOrientationchange:!1},requestAttr:{resize:null},timeAttr:{scrollEnd:null,resizeEnd:null},classAttr:{fixed:"is-fixed"},hasCssSticky:n,on:{"in":null,out:null,hookIn:null,hookOut:null,init:null,allUpdate:null,beforeUpdate:null,afterUpdate:null,update:null}};this.opts=r.def(s,i||{}),(this.obj=o(this.opts.obj)).length&&this.opts.init&&this.init()}var i=window,s=i.document,o=i.jQuery||i.jqLite,n=function(){var t=s.createElement("div");s.body.appendChild(t),t.style.position="sticky";var e=i.getComputedStyle(t,null).getPropertyValue("position");return s.body.removeChild(t),"sticky"==e}(),r={isDevice:function(){var t="ontouchstart"in i||i.DocumentTouch&&s instanceof i.DocumentTouch;return t}(),isOrientationchange:function(){var t="onorientationchange"in i;return t}(),isObject:function(t){return"object"==typeof t&&null!==t&&t.constructor&&t.constructor===Object},def:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];for(var i=Object(t[0]),s=1;s<t.length;s+=1){var o=t[s];if(void 0!==o&&null!==o)for(var n=Object.keys(Object(o)),r=0,a=n.length;a>r;r+=1){var l=n[r],c=Object.getOwnPropertyDescriptor(o,l);void 0!==c&&c.enumerable&&(this.isObject(i[l])&&this.isObject(o[l])?this.def(i[l],o[l]):!this.isObject(i[l])&&this.isObject(o[l])?(i[l]={},this.def(i[l],o[l])):i[l]=o[l])}}return i},winSize:function(){return function(){var t={w:i.innerWidth||s.documentElement.clientWidth||s.body.clientWidth,h:i.innerHeight||s.documentElement.clientHeight||s.body.clientHeight};return t}}(),requestAFrame:function(){return i.requestAnimationFrame||i.webkitRequestAnimationFrame||i.mozRequestAnimationFrame||i.oRequestAnimationFrame||i.msRequestAnimationFrame||function(t){return i.setTimeout(t,1e3/60)}}(),cancelAFrame:function(){return i.cancelAnimationFrame||i.webkitCancelAnimationFrame||i.webkitCancelRequestAnimationFrame||i.mozCancelAnimationFrame||i.oCancelAnimationFrame||i.msCancelAnimationFrame||function(t){i.clearTimeout(t)}}()};return e.prototype={init:function(){this.buildSet(),this.setElements(),this.set.after.build(),this.buildTween(),this.buildMotion(),this.resizeFunc(),this.bindEvents(!0),this.set.load.after()},buildSet:function(){var t=this;r.def(this,{set:{before:{init:function(){var e=t.opts.breakKey,i={};e.forEach(function(e){i[e]=t.opts[e]}),t.bOpts=r.def({},i)},initLayout:function(){var e=t.opts.magicSection.split(".")[1],i=t.opts.magicArticle.split(".")[1],s='<div class="'+e+'"><div class="'+i+'"></div></div>';t.obj.wrap(s)},build:function(){this.init(),this.initLayout()}},after:{initLayout:function(){t.magicSection.css("position","relative"),t.magicArticle.css({position:"sticky",top:0})},buildFixedLayout:function(){var e=t.magicArticle;r.def(t,{fixedlayout:{state:null,current:null,view:function(){this.current!==this.state&&(this.current=this.state,this[this.state]())},out_top:function(){e.css({position:"",bottom:""})},out_bot:function(){e.css({position:"fixed",top:t.opts.props.spaceHeight,bottom:""})},out_bot_pushFollowers:function(){e.css({position:"absolute",top:"",bottom:0})},out_not_initFollowers:function(){e.css({position:"",top:t.opts.props.spaceHeight,bottom:""})}}})},build:function(){this.initLayout(),this.buildFixedLayout()}},load:{before:function(){},after:function(){var e=t.opts.props,s=o(i).scrollTop(),n={hookOutB:s>=e.triggerMaxOffset};n.hookOutB&&(t.opts.fixedAutoPlay||t.tween.pause().progress(1)),t.outCallback("init")}},getSize:{winHeight:r.winSize().h,resize:function(){this.winHeight=r.winSize().h}},opts:function(){var e,i=this,s=r.winSize().w,o=r.winSize().h,n=t.opts.breakpoints,a=[];for(var l in n)l>=s?(a.push(l),e=Math.min.apply(null,a)):e=null;var c=r.def({},t.bOpts);if(null!=e&&(c=r.def(c,n[e])),null==c.duration){var u=t.opts.animations;c.pushFollowers&&c.initFollowers&&!u.length||(c.duration="100%")}var p=function(){var t=Math.floor(c.spaceHeight(),10);return t}(),f=function(){var e=t.obj.outerHeight(!0);if(null!=c.duration){var s=i.getSize.winHeight/100,o=c.duration,n=parseFloat(o),r=o.indexOf("%")>=0,a=s*n;r||(a=n);var l=a-p;e=Math.max(e,l)}return e}(),h=function(){var e=t.magicArticle.outerHeight(!0);return e}();!function(){var e=t.magicSection.offset(),i=t.magicSection.outerHeight(!0),e=e.top,s=Math.ceil(e-o,10),n=Math.ceil(e+i,10),r=function(){var t=1-c.triggerHook;t=0>t?0:t>1?1:t;var e=t*o,i=Math.max(o-p,h+p);if(!c.overlapSpace){var s=o-p;e>=s&&(e-=p)}return{min:e,max:i}}();t.opts.props.offset=e,t.opts.props.minOffset=s,t.opts.props.maxOffset=n,t.opts.props.triggerMinOffset=s+r.min,t.opts.props.triggerMaxOffset=n-r.max,t.opts.props.fixedMinOffset=s+o-p,t.opts.props.fixedMaxOffset=n-h-p}(),t.opts.props.spaceHeight=p,t.opts.props.sectionHeight=f,t.opts.props.articleHeight=h,t.breakOpts=c,t.props=t.opts.props},layout:function(){var e=r.winSize().h,i=t.opts.props,s=t.breakOpts,o=i.spaceHeight,n=i.sectionHeight,a=i.articleHeight,l=null==s.duration?"":n,c=null==s.duration?"":o;t.magicSection.css({height:t.opts.hasCssSticky?l:n}),t.opts.hasCssSticky&&t.magicArticle.css({top:c}),t.opts.hasCssSticky&&s.initFollowers||t.magicArticle.css({width:t.magicSection.outerWidth(!0)}),t.magicArticle.css(s.pushFollowers?{"margin-bottom":""}:{"margin-bottom":-1*Math.max(e-o,a+o)})},destroy:function(){t.obj.parent().is(t.opts.magicArticle)&&t.obj.unwrap(),t.obj.parent().is(t.opts.magicSection)&&t.obj.unwrap()}}}),this.set.before.build()},setElements:function(){this.magicArticle=this.obj.parent(this.opts.magicArticle),this.magicSection=this.magicArticle.parent(this.opts.magicSection)},buildTween:function(){var t=this;r.def(this,{tween:{instance:null,destroy:function(){null!=this.instance&&(this.instance.kill(),this.instance=null)},delTweenID:function(t){var e=r.def({},t);return e.hasOwnProperty("_gsTweenID")&&delete e._gsTweenID,e},pause:function(){return null==this.instance?this:(this.instance.pause(),this)},progress:function(t){return null==this.instance?this:(this.instance.progress(t),this)},build:function(){var e=t.opts.animations;if(e.length){var i=this,s=new TimelineMax;s.pause();for(var o=function(t){var o=e[t],n=function(t){var e={};return e.progress="start"==t?0:1,e},a=o.hasOwnProperty("from")?o.from:n("start"),l=o.hasOwnProperty("to")?o.to:n("end"),c=o.hasOwnProperty("duration")?o.duration:0,u=o.hasOwnProperty("onStart"),p=o.hasOwnProperty("onUpdate"),f=o.hasOwnProperty("onComplete"),h=o.hasOwnProperty("onReverseComplete");s.to(a,c,r.def(l,{onUpdate:function(){p&&o.onUpdate(i.delTweenID(a))},onStart:function(){u&&o.onStart(i.delTweenID(a))},onComplete:function(){f&&o.onComplete(i.delTweenID(a))},onReverseComplete:function(){h&&o.onReverseComplete(i.delTweenID(a))}}))},n=0,a=e.length;a>n;n++)o.call(i,n);this.instance=s}}}}),this.tween.build()},buildMotion:function(){var t=this,e=this.opts.props,s=this.opts.classAttr;r.def(this,{motion:{progress:{allUpdate:function(s){var n=o(i).scrollTop();if(s)var r=e.maxOffset-e.minOffset,a=n-e.minOffset,l=a/r;else var l=e.minOffset<=n?1:0;t.opts.props.allProgress=l,t.outCallback("allUpdate")},beforeUpdate:function(s){var n=o(i).scrollTop();if(s)var r=e.triggerMinOffset-e.minOffset,a=n-e.minOffset,l=a/r;else var l=e.minOffset<=n?1:0;t.opts.props.afterProgress=0,t.opts.props.beforeProgress=l,t.outCallback("beforeUpdate")},afterUpdate:function(s){var n=o(i).scrollTop();if(s)var r=e.maxOffset-e.triggerMaxOffset,a=n-e.triggerMaxOffset,l=a/r;else var l=e.triggerMaxOffset<=n?1:0;t.opts.props.beforeProgress=1,t.opts.props.afterProgress=l,t.outCallback("afterUpdate")},update:function(s){var n=o(i).scrollTop();if(s)var r=e.triggerMaxOffset-e.triggerMinOffset,a=n-e.triggerMinOffset,l=a/r;else var l=e.triggerMinOffset<=n?1:0;t.opts.props.beforeProgress=1,t.opts.props.afterProgress=0,t.opts.props.progress=l,t.tween.progress(l),t.outCallback("update")}},scroll:{stateAttr:{active:null,hookActive:null,fixedActive:null},scope:{out:null,hookOut:null},destroy:function(){},build:function(){var n=o(i).scrollTop(),r=t.breakOpts,a={"in":e.minOffset<=n&&n<e.maxOffset,hookIn:e.triggerMinOffset<=n&&n<e.triggerMaxOffset,fixedIn:e.fixedMinOffset<=n&&n<e.fixedMaxOffset};a["in"]&&(t.opts.hasCssSticky||r.initFollowers&&(r.pushFollowers||("FORWARD"==e.direction?t.fixedlayout.state="out_top":"REVERSE"==e.direction&&(t.fixedlayout.state="out_bot"))),r.initFollowers||(t.fixedlayout.state="out_bot")),a.hookIn||(e.triggerMinOffset>n?this.scope.hookOut="TOP":n>=e.triggerMaxOffset&&(this.scope.hookOut="BOTTOM")),a.fixedIn&&(t.opts.hasCssSticky||r.initFollowers&&(t.fixedlayout.state="out_bot"),t.magicArticle.addClass(s.fixed),r.initFollowers||(t.fixedlayout.state="out_bot")),a.fixedIn||(t.opts.hasCssSticky||r.initFollowers&&(e.fixedMinOffset>n?t.fixedlayout.state="out_top":n>=e.fixedMaxOffset&&(t.fixedlayout.state=r.pushFollowers?"out_bot_pushFollowers":"out_bot")),t.magicArticle.removeClass(s.fixed),r.initFollowers||r.pushFollowers&&n>=e.fixedMaxOffset&&(t.fixedlayout.state="out_bot_pushFollowers")),a["in"]||(t.opts.hasCssSticky||r.initFollowers&&(r.pushFollowers||(e.minOffset>n?t.fixedlayout.state="out_top":n>=e.maxOffset&&(t.fixedlayout.state="out_bot_pushFollowers"))),e.minOffset>n?(this.scope.out="TOP",t.opts.props.beforeProgress=0,t.opts.props.afterProgress=0,t.opts.props.allProgress=0,t.opts.props.progress=0):n>=e.maxOffset&&(this.scope.out="BOTTOM",t.opts.props.beforeProgress=1,t.opts.props.afterProgress=1,t.opts.props.allProgress=1,t.opts.props.progress=1),r.initFollowers||(t.fixedlayout.state="out_not_initFollowers")),t.fixedlayout.view(),a["in"]&&"in"!=this.stateAttr.active&&(this.stateAttr.active="in",t.outCallback("in")),a.hookIn||"out"!=this.stateAttr.hookActive&&(this.stateAttr.hookActive="out",t.motion.progress.update(!1),t.outCallback("hookOut")),a["in"]&&(t.motion.progress.allUpdate(!0),e.minOffset<=n&&n<e.triggerMinOffset&&t.motion.progress.beforeUpdate(!0)),a.hookIn&&("in"!=this.stateAttr.hookActive&&(this.stateAttr.hookActive="in","FORWARD"==e.direction?t.motion.progress.beforeUpdate(!1):"REVERSE"==e.direction&&t.motion.progress.afterUpdate(!1),t.outCallback("hookIn")),t.motion.progress.update(!0)),a.fixedIn&&"in"!=this.stateAttr.fixedActive&&(this.stateAttr.fixedActive="in"),a.fixedIn||"out"!=this.stateAttr.fixedActive&&(this.stateAttr.fixedActive="out"),a["in"]&&e.triggerMaxOffset<=n&&n<e.maxOffset&&t.motion.progress.afterUpdate(!0),a["in"]||"out"!=this.stateAttr.active&&(this.stateAttr.active="out",e.minOffset>n?t.motion.progress.beforeUpdate(!1):n>=e.maxOffset&&t.motion.progress.afterUpdate(!1),t.motion.progress.allUpdate(!1),t.outCallback("out"))}},destroy:function(){this.scroll.destroy()},build:function(){this.scroll.build()}}})},changeEvents:function(t){var e=[],i=t.split(" ");for(var s in i)e.push(i[s]+this.opts.customEvent);return e.join(" ")},bindEvents:function(t){t?(o(i).on(this.changeEvents("scroll"),this.scrollFunc.bind(this)),o(i).on(this.changeEvents("resize orientationchange"),this.resizeFunc.bind(this))):(o(i).off(this.changeEvents("scroll")),o(i).off(this.changeEvents("resize orientationchange")))},scrollFunc:function(){this.winTop=o(i).scrollTop(),this.opts.stateAttr.prevTop>this.winTop?this.opts.props.direction="REVERSE":this.opts.stateAttr.prevTop<this.winTop&&(this.opts.props.direction="FORWARD"),this.opts.stateAttr.prevTop=this.winTop,null==this.opts.stateAttr.scroll&&(this.opts.stateAttr.scroll=this.winTop,this.scrollAnimateFunc()),i.clearTimeout(this.opts.timeAttr.scrollEnd),this.opts.timeAttr.scrollEnd=i.setTimeout(this.scrollEndFunc.bind(this),60)},scrollEndFunc:function(){this.opts.stateAttr.scroll=null,this.scrollAct(),r.cancelAFrame.call(i,this.opts.requestAttr.scroll)},scrollAnimateFunc:function(){this.scrollAct(),this.opts.requestAttr.scroll=r.requestAFrame.call(i,this.scrollAnimateFunc.bind(this))},scrollAct:function(){this.opts.stateAttr.destroy||(this.set.opts(),this.motion.build())},resizeFunc:function(e){e!=t&&"orientationchange"==e.type&&(this.opts.stateAttr.isOrientationchange=!0),this.winWidth=r.winSize().w,null==this.opts.stateAttr.resize&&(this.opts.stateAttr.resize=this.winWidth,this.resizeAnimateFunc()),i.clearTimeout(this.opts.timeAttr.resizeEnd),this.opts.timeAttr.resizeEnd=i.setTimeout(this.resizeEndFunc.bind(this),280)},resizeEndFunc:function(){this.opts.stateAttr.resize=null,this.resizeAct(),this.opts.stateAttr.isOrientationchange=!1,r.cancelAFrame.call(i,this.opts.requestAttr.resize)},resizeAnimateFunc:function(){this.resizeAct(),this.opts.requestAttr.resize=r.requestAFrame.call(i,this.resizeAnimateFunc.bind(this))},resizeAct:function(){this.opts.stateAttr.destroy||(r.isOrientationchange?this.opts.stateAttr.isOrientationchange&&this.set.getSize.resize():this.set.getSize.resize(),this.set.opts(),this.set.layout(),this.scrollFunc())},destroy:function(){this.opts.stateAttr.destroy=!0,this.bindEvents(!1),this.set.destroy(),this.tween.destroy(),this.motion.destroy()},outCallback:function(t){var e=this.opts.on[t];null!=e&&e()}},e}();return t});