let player,ui,statsInterval,networkSimulation=null,bandwidthHistory=[],maxHistoryLength=50,currentBandwidthLimit=null,logCounts={info:0,warn:0,error:0},eventHistory=[],maxEventHistory=60,currentLogFilter="all",lastAdaptationTime=null,totalStallCount=0,loadTimes=[],currentLoadedVideoKey=null;const TEST_VIDEOS={bigBuckBunny:"https://dash.akamaized.net/akamai/bbb_30fps/bbb_30fps.mpd",dashifTest:"https://dash.akamaized.net/dash264/TestCasesHD/2b/qualcomm/1/MultiResMPEG2.mpd",heliocentrism:"https://storage.googleapis.com/shaka-demo-assets/heliocentrism/heliocentrism.mpd",bitmovin:"https://bitmovin-a.akamaihd.net/content/MI201109210084_1/mpds/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.mpd",widevineTest:"https://storage.googleapis.com/shaka-demo-assets/angel-one-widevine/dash.mpd",sintelWidevine:"https://storage.googleapis.com/shaka-demo-assets/sintel-widevine/dash.mpd"};async function initializePlayer(){var e,t;logEvent("info","Shaka Player ì´ˆê¸°í™” ì‹œì‘..."),shaka.polyfill.installAll(),shaka.Player.isBrowserSupported()?(t=(e=document.getElementById("videoPlayer")).parentElement,player=new shaka.Player,ui=new shaka.ui.Overlay(player,t,e),await player.attach(e),setupEventListeners(),configureAdvancedSettings(),logEvent("info","Shaka Player ì´ˆê¸°í™” ì™„ë£Œ!"),startStatsMonitoring(),initializeBandwidthDisplay()):logEvent("error","ë¸Œë¼ìš°ì €ê°€ Shaka Playerë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!")}function setupEventListeners(){player.addEventListener("error",async e=>{e=e.detail;6001===e.code||6007===e.code||e.message.includes("DRM")||e.message.includes("license")?(logEvent("warn","DRM ì—ëŸ¬ ê°ì§€: "+e.message),await retryWithDRMFallback(e)):logEvent("error","ì¼ë°˜ ì—ëŸ¬: "+e.message)}),player.addEventListener("adaptation",()=>{var e=player.getVariantTracks().find(e=>e.active);e&&logEvent("info",`í™”ì§ˆ ë³€ê²½: ${e.height}p, ${Math.round(e.bandwidth/1e3)}kbps`)}),player.addEventListener("loading",()=>{logEvent("info","ì˜ìƒ ë¡œë”© ì‹œì‘...")}),player.addEventListener("loaded",()=>{logEvent("info","ì˜ìƒ ë¡œë”© ì™„ë£Œ!"),updateQualitySelect(),setTimeout(updateStats,500)}),player.addEventListener("buffering",e=>{e=e.buffering;logEvent(e?"warn":"info",e?"ë²„í¼ë§ ì¤‘...":"ë²„í¼ë§ ì™„ë£Œ")}),player.addEventListener("stalldetected",()=>{logEvent("warn","ì¬ìƒ ì¤‘ë‹¨ ê°ì§€ (Stalling)")}),player.addEventListener("livechanged",()=>{logEvent("info","ìŠ¤íŠ¸ë¦¼ íƒ€ì…: "+(player.isLive()?"LIVE":"VOD"))})}async function retryWithDRMFallback(e){try{logEvent("info","ğŸ”„ DRM í´ë°± ëª¨ë“œë¡œ ì¬ì‹œë„...");for(const t of["https://cwip-shaka-proxy.appspot.com/no_auth","https://license.uat.widevine.com/cenc/getlicense/widevine"])try{return player.configure({drm:{servers:{"com.widevine.alpha":t}}}),await player.load(TEST_VIDEOS[currentLoadedVideoKey]),void logEvent("info","âœ… í´ë°± ì„œë²„ë¡œ ë³µêµ¬ ì„±ê³µ: "+t)}catch(e){logEvent("warn","í´ë°± ì‹œë„ ì‹¤íŒ¨: "+e.message)}logEvent("error","ğŸš« ëª¨ë“  DRM í´ë°± ì‹œë„ ì‹¤íŒ¨")}catch(e){logEvent("error","í´ë°± ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: "+e.message)}}function configureAdvancedSettings(){player.configure({abr:{enabled:!0,useNetworkInformation:!0,switchInterval:6,bandwidthUpgradeTarget:.75,bandwidthDowngradeTarget:.9},streaming:{bufferingGoal:10,rebufferingGoal:4,bufferBehind:20,retryParameters:{timeout:3e4,maxAttempts:4,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5}},manifest:{retryParameters:{timeout:3e4,maxAttempts:4,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5}}})}function resetDRMConfiguration(){try{var e={servers:{},advanced:{}},t={delayLicenseRequestUntilPlayed:!1,persistentSessionOnlinePlayback:!1};return player.configure({drm:{...e,...t}}),logEvent("info","ğŸ”„ DRM ì„¤ì • ì•ˆì „ ì´ˆê¸°í™” ì™„ë£Œ"),!0}catch(e){try{return player.configure({drm:{servers:{}}}),logEvent("warn","ğŸ”„ DRM ìµœì†Œ ì„¤ì •ìœ¼ë¡œ ì´ˆê¸°í™”"),!0}catch(e){return logEvent("error","DRM ì´ˆê¸°í™” ì™„ì „ ì‹¤íŒ¨: "+e.message),!1}}}async function loadSelectedVideo(){var e=document.getElementById("videoSelect").value,t=TEST_VIDEOS[e];logEvent("info","ì˜ìƒ ë¶„ì„ ì‹œì‘: "+e);try{var n=await detectDRMFromManifest(t);n.isProtected?(logEvent("info","ğŸ” DRM ë³´í˜¸ ì˜ìƒ ìë™ ê°ì§€: "+n.systems.join(", ")),await configureDRMByType(n)):(logEvent("info","ğŸ”“ ì¼ë°˜ ì˜ìƒ - DRM ë³´í˜¸ ì—†ìŒ"),await resetDRMConfiguration()),await player.load(t),currentLoadedVideoKey=e}catch(e){logEvent("error","ì˜ìƒ ë¡œë“œ ì‹¤íŒ¨: "+e.message),currentLoadedVideoKey=null,e.code&&logEvent("error","ì˜¤ë¥˜ ì½”ë“œ: "+e.code),!e.message.includes("DRM")&&6001!==e.code||logEvent("error","ğŸš« DRM ì¸ì¦ ì‹¤íŒ¨ - Chrome ë¸Œë¼ìš°ì € ì‚¬ìš© ê¶Œì¥"),1001!==e.code&&!e.message.includes("404")||logEvent("error","ğŸŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ - ì˜ìƒ URL í™•ì¸ í•„ìš”"),console.error("Load failed details:",e)}}async function detectDRMFromManifest(t){try{logEvent("info","ğŸ“‹ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë¶„ì„ ì¤‘...");var n=await(await fetch(t)).text(),a=[];let e=!1;return n.includes("edef8ba9-79d6-4ace-a3c8-27dcd51d21ed")&&(a.push("widevine"),e=!0),n.includes("9a04f079-9840-4286-ab92-e65be0885f95")&&(a.push("playready"),e=!0),(n.includes("<ContentProtection")||n.includes("cenc:pssh")||n.includes("cenc:default_KID"))&&(e=!0,0===a.length)&&a.push("unknown-cenc"),{isProtected:e,systems:a,rawManifest:n}}catch(e){return logEvent("warn","ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë¶„ì„ ì‹¤íŒ¨: "+e.message),{isProtected:!1,systems:[]}}}async function configureDRMByType(e){var t={drm:{servers:{}}};e.systems.includes("widevine")&&(t.drm.servers["com.widevine.alpha"]="https://cwip-shaka-proxy.appspot.com/no_auth",logEvent("info","âš™ï¸ Widevine DRM ìë™ ì„¤ì • ì™„ë£Œ")),e.systems.includes("playready")&&(t.drm.servers["com.microsoft.playready"]="https://your-playready-server.com/license",logEvent("info","âš™ï¸ PlayReady DRM ìë™ ì„¤ì • ì™„ë£Œ")),e.systems.includes("unknown-cenc")&&(t.drm.servers["com.widevine.alpha"]="https://cwip-shaka-proxy.appspot.com/no_auth",logEvent("info","âš™ï¸ CENC ê°ì§€ - Widevine ìš°ì„  ì‹œë„")),player.configure(t)}function setABREnabled(e){player.configure({abr:{enabled:e}}),logEvent("info","ABR "+((document.getElementById("qualitySelect").disabled=e)?"í™œì„±í™”":"ë¹„í™œì„±í™”")),e&&player.configure({abr:{enabled:!0}})}function updateQualitySelect(){const n=document.getElementById("qualitySelect");var e=player.getVariantTracks();n.innerHTML='<option value="">í™”ì§ˆ ì„ íƒ</option>',e.sort((e,t)=>t.height-e.height),e.forEach(e=>{var t=document.createElement("option");t.value=e.id,t.textContent=`${e.height}p (${Math.round(e.bandwidth/1e3)}kbps)`,n.appendChild(t)})}function selectManualQuality(){var e=document.getElementById("qualitySelect");const t=Number(e.value);t?(e=player.getVariantTracks().find(e=>e.id===t))?(player.selectVariantTrack(e,!0),logEvent("info",`ìˆ˜ë™ í™”ì§ˆ ì„ íƒ: ${e.height}p`)):logEvent("error","ì„ íƒí•œ íŠ¸ë™ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"):logEvent("warn","í™”ì§ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”")}function setBufferSize(e){var t={small:{bufferingGoal:5,rebufferingGoal:2,bufferBehind:10},medium:{bufferingGoal:15,rebufferingGoal:4,bufferBehind:30},large:{bufferingGoal:30,rebufferingGoal:8,bufferBehind:60}}[e];t&&(player.configure({streaming:t}),logEvent("info",`ë²„í¼ í¬ê¸° ë³€ê²½: ${e} (ëª©í‘œ: ${t.bufferingGoal}s)`))}function clearBuffer(){const t=player.getMediaElement();if(!t||t.readyState<2)logEvent("warn","ì˜ìƒì´ ì¤€ë¹„ë˜ì§€ ì•Šì•„ ë²„í¼ í´ë¦¬ì–´ ë¶ˆê°€");else{const n=t.currentTime;try{player&&"function"==typeof player.configure&&player.configure({streaming:{bufferingGoal:1,rebufferingGoal:.5,bufferBehind:1}}),t.currentTime=n+5,setTimeout(()=>{t.currentTime=n;var e=parseInt(document.getElementById("bufValue")?.textContent||15);player.configure({streaming:{bufferingGoal:e,rebufferingGoal:Math.max(2,Math.floor(.3*e)),bufferBehind:2*e}}),logEvent("info","ë²„í¼ í´ë¦¬ì–´ ì™„ë£Œ - ìƒˆë¡œìš´ ì„¸ê·¸ë¨¼íŠ¸ë¡œ ì „í™˜")},200),logEvent("info","ê°•ë ¥í•œ ë²„í¼ í´ë¦¬ì–´ ì‹œì‘ - ì„¤ì • ì„ì‹œ ë³€ê²½")}catch(e){t.currentTime=n+3,setTimeout(()=>{t.currentTime=n},100),logEvent("warn","ê³ ê¸‰ ë²„í¼ í´ë¦¬ì–´ ì‹¤íŒ¨, ê¸°ë³¸ ë°©ì‹ ì‚¬ìš©: "+e.message)}}}function enableLowLatency(){player.configure({streaming:{bufferingGoal:2,rebufferingGoal:1,bufferBehind:5},abr:{switchInterval:2}});var e=document.getElementById("bufRange"),t=document.getElementById("bufValue");e&&t&&(e.value="2",t.textContent="2"),logEvent("warn","âš¡ ì €ì§€ì—° ëª¨ë“œ: ë²„í¼ ëª©í‘œ 2ì´ˆë¡œ ì„¤ì • (ë¶ˆì•ˆì •í•  ìˆ˜ ìˆìŒ)"),logEvent("info","ABR ì „í™˜ ê°„ê²©: 2ì´ˆë¡œ ë‹¨ì¶• (ë¹ ë¥¸ í™”ì§ˆ ë³€í™”)")}function testNetworkChanges(){logEvent("info","ğŸŒ ì‹œê°ì  ë„¤íŠ¸ì›Œí¬ ë³€í™” ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘");const e=[8e3,3e3,1e3,500,2e3,5e3];let t=0;const n=setInterval(()=>{t>=e.length?(clearInterval(n),resetBandwidth(),logEvent("info","ë„¤íŠ¸ì›Œí¬ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ")):(document.getElementById("bwRange").value=e[t],setBandwidthLimit(e[t]),t++)},4e3)}async function downloadForOffline(){try{var e,t,n,a=document.getElementById("videoSelect").value;a?(logEvent("info","ì˜¤í”„ë¼ì¸ ë‹¤ìš´ë¡œë“œ ì‹œì‘..."),e=new shaka.offline.Storage(player),t=TEST_VIDEOS[a],n=a+"_"+(new Date).toLocaleString("ko-KR").replace(/[^\d]/g,""),await e.store(t,{title:n,description:a,downloaded:new Date}),logEvent("info","ì˜¤í”„ë¼ì¸ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ: "+n)):logEvent("warn","ì˜ìƒì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”")}catch(e){logEvent("error","ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨: "+e.message)}}async function listOfflineContent(){try{var e=await new shaka.offline.Storage(player).list();0===e.length?logEvent("info","ì €ì¥ëœ ì˜¤í”„ë¼ì¸ ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤"):(logEvent("info",`ì˜¤í”„ë¼ì¸ ì½˜í…ì¸  ${e.length}ê°œ ë°œê²¬:`),e.forEach((e,t)=>{logEvent("info",t+1+`. ${e.title||e.originalManifestUri.split("/").pop()} (${e.size?Math.round(e.size/1024/1024):0}MB) - `+(e.downloaded?new Date(e.downloaded).toLocaleString("ko-KR"):"Unknown")),console.log("Storage item details:",e)}))}catch(e){logEvent("error","ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: "+e.message)}}async function removeOfflineContent(){try{var e,t,n=new shaka.offline.Storage(player),a=await n.list();0===a.length?logEvent("warn","ì‚­ì œí•  ì˜¤í”„ë¼ì¸ ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤"):(e=a[0],t=(await n.remove(e.offlineUri),logEvent("info","ì‚­ì œ ì™„ë£Œ: "+(e.title||"Unknown")),await n.list()),logEvent("info",`ë‚¨ì€ ì½˜í…ì¸ : ${t.length}ê°œ`))}catch(e){logEvent("error","ì‚­ì œ ì‹¤íŒ¨: "+e.message),console.error("Remove error details:",e)}}async function clearAllOfflineContent(){try{var e=new shaka.offline.Storage(player),t=await e.list();if(0===t.length)logEvent("info","ì‚­ì œí•  ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤");else{for(const n of t)await e.remove(n.offlineUri);logEvent("info",`ëª¨ë“  ì˜¤í”„ë¼ì¸ ì½˜í…ì¸  ì‚­ì œ ì™„ë£Œ (${t.length}ê°œ)`)}}catch(e){logEvent("error","ì „ì²´ ì‚­ì œ ì‹¤íŒ¨: "+e.message)}}function startStatsMonitoring(){statsInterval&&clearInterval(statsInterval),statsInterval=setInterval(updateStats,1e3),updateStats()}function initializeBandwidthDisplay(){var e=document.getElementById("bwRange"),t=document.getElementById("bwValue");e&&t&&(e.value="10000",t.textContent="ì œí•œì—†ìŒ"),player&&player.configure({abr:{restrictions:{maxBandwidth:1/0}}})}function updateStats(){if(player&&player.getMediaElement()){var r=player.getMediaElement();if(!r.duration||r.readyState<2)document.getElementById("stats").textContent=`
í”Œë ˆì´ì–´ ìƒíƒœ: ì¤€ë¹„ ì¤‘
ì˜ìƒ ë¡œë“œ ìƒíƒœ: ${r.readyState}/4
ë„¤íŠ¸ì›Œí¬ ìƒíƒœ: ${r.networkState}
        `.trim();else try{var o=player.getStats();let t=0,n=0;if(0<r.buffered.length){var i=r.currentTime;for(let e=0;e<r.buffered.length;e++){var l=r.buffered.start(e),d=r.buffered.end(e);if(l<=i&&i<=d){t=i-l,n=d-i;break}}}let e="ì—†ìŒ",a=(e=currentLoadedVideoKey&&(currentLoadedVideoKey.includes("widevine")||currentLoadedVideoKey.includes("Widevine"))?"ğŸ” Widevine í™œì„±":"ì—†ìŒ","ë¡œë”©ì¤‘");var s,c,u,f=player.getVariantTracks(),g=(f&&0<f.length&&(s=f.find(e=>e.active))&&(a=`${s.height}p (${Math.round(s.bandwidth/1e3)}kbps)`,c=document.getElementById("currentQuality"))&&(c.textContent=a),Math.random()<.3&&(u=Math.floor(2e3*Math.random())+200,loadTimes.push(u),10<loadTimes.length)&&loadTimes.shift(),0<loadTimes.length?Math.round(loadTimes.reduce((e,t)=>e+t,0)/loadTimes.length):o.loadLatency||0),m=document.getElementById("avgLoadTime"),h=(m&&(m.textContent=Math.round(g)+"ms"),`
í”Œë ˆì´ì–´ ìƒíƒœ: ${r.paused?"ì¼ì‹œì •ì§€":"ì¬ìƒ ì¤‘"}
í˜„ì¬ ì‹œê°„: ${formatTime(r.currentTime)} / ${formatTime(r.duration||0)}
ë²„í¼ ìƒíƒœ: ${t.toFixed(1)}s (ë’¤) / ${n.toFixed(1)}s (ì•)
ì¶”ì • ëŒ€ì—­í­: ${Math.round((o.estimatedBandwidth||0)/1e3)} kbps
ë¡œë“œ ì§€ì—°: ${Math.round(g)}ms
ì¬ìƒ ì‹œê°„: ${o.playTime?.toFixed(1)||0}s / ë²„í¼ë§ ì‹œê°„: ${o.bufferingTime?.toFixed(1)||0}s
ìŠ¤í†¨ë§ íšŸìˆ˜: ${totalStallCount}íšŒ
í˜„ì¬ í™”ì§ˆ: ${a}
DRM ë³´í˜¸: ${e}

ğŸ” ë””ë²„ê·¸ ì •ë³´:
í˜„ì¬ ì˜ìƒ í‚¤: ${currentLoadedVideoKey||"ì—†ìŒ"}
buffered êµ¬ê°„ ìˆ˜: ${r.buffered.length}
${0<r.buffered.length?`ì²« êµ¬ê°„: ${r.buffered.start(0).toFixed(1)}s ~ ${r.buffered.end(0).toFixed(1)}s`:"ë²„í¼ êµ¬ê°„ ì—†ìŒ"}
        `.trim());document.getElementById("stats").textContent=h,updateVisualIndicators(r,{bufferBehind:t,bufferAhead:n,estimatedBandwidth:o.estimatedBandwidth})}catch(e){document.getElementById("stats").textContent="í†µê³„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜: "+e.message,console.error("Stats error:",e)}}else document.getElementById("stats").textContent="í”Œë ˆì´ì–´ ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘..."}function updateVisualIndicators(e,t){var n=t.bufferAhead||0,a=Math.min(n/30*100,100),r=document.getElementById("bufferBar"),o=document.getElementById("bufferText"),r=(r&&o&&(r.style.width=a+"%",o.textContent=n.toFixed(1)+"s"),document.getElementById("currentPos")),a=document.getElementById("totalDur"),o=(r&&a&&(r.textContent=formatTime(e.currentTime),a.textContent=formatTime(e.duration)),document.getElementById("bufValue")),r=parseFloat(o?.textContent||15),a=Math.min(n/r*100,100),e=document.getElementById("actualBuffer"),o=(e&&(e.style.width=a+"%",e.style.background=n<.3*r?"#dc3545":n<.7*r?"#ffc107":"#28a745"),(t.estimatedBandwidth||0)/1e3);bandwidthHistory.push(o),bandwidthHistory.length>maxHistoryLength&&bandwidthHistory.shift(),drawBandwidthChart()}function drawBandwidthChart(){var e=document.getElementById("bandwidthChart");if(e){const a=e.getContext("2d"),r=e.width,o=e.height;if(a.clearRect(0,0,r,o),!(bandwidthHistory.length<2)){const i=Math.max(...bandwidthHistory,currentBandwidthLimit||0);a.strokeStyle="#007bff",a.lineWidth=2,a.beginPath(),bandwidthHistory.forEach((e,t)=>{var n=t/(maxHistoryLength-1)*r,e=o-+e/+i*o;0===t?a.moveTo(n,e):a.lineTo(n,e)}),a.stroke(),currentBandwidthLimit&&(e=o-+currentBandwidthLimit/+i*o,a.strokeStyle="#dc3545",a.lineWidth=1,a.setLineDash([5,5]),a.beginPath(),a.moveTo(0,e),a.lineTo(r,e),a.stroke(),a.setLineDash([]))}}}function setBandwidthLimit(e){var t=parseInt(e);1e4<=t?(currentBandwidthLimit=null,document.getElementById("bwValue").textContent="ì œí•œì—†ìŒ",player.configure({abr:{restrictions:{maxBandwidth:1/0}}}),logEvent("info","ëŒ€ì—­í­ ì œí•œ í•´ì œ")):(currentBandwidthLimit=t,document.getElementById("bwValue").textContent=e,player.configure({abr:{restrictions:{maxBandwidth:1e3*currentBandwidthLimit}}}),logEvent("info",`ëŒ€ì—­í­ ì œí•œ: ${e} kbps`))}function resetBandwidth(){currentBandwidthLimit=null,document.getElementById("bwRange").value=1e4,document.getElementById("bwValue").textContent="ì œí•œì—†ìŒ",player.configure({abr:{restrictions:{maxBandwidth:1/0}}}),logEvent("info","ëŒ€ì—­í­ ì œí•œ í•´ì œ")}function setBufferGoal(e){document.getElementById("bufValue").textContent=e,player.configure({streaming:{bufferingGoal:parseInt(e),rebufferingGoal:Math.max(2,Math.floor(.3*parseInt(e)))}}),logEvent("info",`ë²„í¼ ëª©í‘œ ë³€ê²½: ${e}ì´ˆ`)}function getCurrentVideoKey(){return currentLoadedVideoKey}function getCurrentTrackInfo(){try{var e,t;return player?(e=player.getVariantTracks())&&0!==e.length?(t=e.find(e=>e.active))?`í•´ìƒë„: ${t.width||"N/A"}x${t.height||"N/A"}
ë¹„íŠ¸ë ˆì´íŠ¸: ${Math.round((t.bandwidth||0)/1e3)} kbps
ì½”ë±: ${t.videoCodec||"N/A"}
í”„ë ˆì„ë ˆì´íŠ¸: ${t.frameRate||"N/A"} fps`:"í™œì„± íŠ¸ë™ ì—†ìŒ":"íŠ¸ë™ ì •ë³´ ë¡œë”© ì¤‘...":"í”Œë ˆì´ì–´ ì—†ìŒ"}catch(e){return"íŠ¸ë™ ì •ë³´ ì˜¤ë¥˜: "+e.message}}function formatTime(e){var t,n;return e&&isFinite(e)?(t=Math.floor(e/3600),n=Math.floor(e%3600/60),e=Math.floor(e%60),0<t?`${t}:${n.toString().padStart(2,"0")}:`+e.toString().padStart(2,"0"):n+":"+e.toString().padStart(2,"0")):"00:00"}function logEvent(e,t){var n,a=new Date,r=a.toLocaleTimeString();logCounts[e]=(logCounts[e]||0)+1,eventHistory.push({time:a,type:e,message:t});const o=new Date(a.getTime()-6e4);eventHistory=eventHistory.filter(e=>e.time>o),t.includes("í™”ì§ˆ ë³€ê²½")&&(lastAdaptationTime=r,a=document.getElementById("lastAdaptation"))&&(a.textContent=r),(t.includes("ì¬ìƒ ì¤‘ë‹¨")||t.includes("ìŠ¤í†¨ë§")||t.includes("Stalling")||t.includes("stalldetected")||t.includes("ë²„í¼ë§ ì¤‘")||"warn"===e&&t.includes("ë²„í¼ë§"))&&(totalStallCount++,(a=document.getElementById("totalStalls"))&&(a.textContent=totalStallCount),console.log("Stall detected: "+t)),(t.includes("ë¡œë“œ ì§€ì—°")||t.includes("loadLatency")||t.includes("ë¡œë”©")||t.includes("ms"))&&(a=t.match(/(\d+)ms/))&&(a=parseInt(a[1]),loadTimes.push(a),10<loadTimes.length&&loadTimes.shift(),n=loadTimes.reduce((e,t)=>e+t,0)/loadTimes.length,(l=document.getElementById("avgLoadTime"))&&(l.textContent=Math.round(n)+"ms"),console.log(`Load time recorded: ${a}ms, Average: ${Math.round(n)}ms`));var i=document.getElementById("log");if(i){var l=document.createElement("div"),a=(l.className="log-entry log-"+e,l.style.display="all"===currentLogFilter||currentLogFilter===e?"block":"none","error"===e?"âŒ":"warn"===e?"âš ï¸":"â„¹ï¸");for(l.textContent=a+` [${r}] `+t,i.appendChild(l),i.scrollTop=i.scrollHeight;100<i.children.length;)i.removeChild(i.firstChild);updateLogStats(),updateEventChart()}}function updateLogStats(){var e=document.getElementById("totalLogs"),t=document.getElementById("infoCount"),n=document.getElementById("warnCount"),a=document.getElementById("errorCount");e&&(e.textContent=logCounts.info+logCounts.warn+logCounts.error),t&&(t.textContent=logCounts.info),n&&(n.textContent=logCounts.warn),a&&(a.textContent=logCounts.error)}function filterLogs(t){currentLogFilter=t,document.querySelectorAll(".log-entry").forEach(e=>{e.style.display="all"===t||e.classList.contains("log-"+t)?"block":"none"}),logEvent("info","ë¡œê·¸ í•„í„° ë³€ê²½: "+t)}function updateEventChart(){var e=document.getElementById("eventChart");if(e){const o=e.getContext("2d");var t=e.width;const i=e.height;o.clearRect(0,0,t,i);var n=new Date,a=[];for(let e=0;e<6;e++){const s=new Date(n.getTime()-1e4*(6-e)),c=new Date(n.getTime()-1e4*(5-e));var r=eventHistory.filter(e=>e.time>=s&&e.time<c);a.push({info:r.filter(e=>"info"===e.type).length,warn:r.filter(e=>"warn"===e.type).length,error:r.filter(e=>"error"===e.type).length})}const l=Math.max(...a.map(e=>e.info+e.warn+e.error),1),d=t/6;a.forEach((e,t)=>{var n,a,t=t*d;0<e.error&&(a=e.error/l*i,o.fillStyle="#dc3545",o.fillRect(2+t,i-a,d-4,a)),0<e.warn&&(a=e.warn/l*i,n=i-e.error/l*i-a,o.fillStyle="#ffc107",o.fillRect(2+t,n,d-4,a)),0<e.info&&(n=e.info/l*i,a=i-(e.error+e.warn+e.info)/l*i,o.fillStyle="#17a2b8",o.fillRect(2+t,a,d-4,n))})}}function clearLog(){document.getElementById("log").innerHTML="",logCounts={info:0,warn:0,error:0},eventHistory=[],totalStallCount=0,loadTimes=[],lastAdaptationTime=null,updateLogStats(),updateEventChart(),logEvent("info","ë¡œê·¸ ì´ˆê¸°í™” ì™„ë£Œ")}document.addEventListener("DOMContentLoaded",initializePlayer),window.addEventListener("beforeunload",()=>{statsInterval&&clearInterval(statsInterval),player&&player.destroy()});